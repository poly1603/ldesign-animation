<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>性能基准测试 - @ldesign/animation</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 40px;
      background: #f5f5f5;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: #333;
      margin-bottom: 40px;
    }

    .benchmark-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
      margin-bottom: 40px;
    }

    .benchmark-card {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .benchmark-card h2 {
      margin-bottom: 20px;
      color: #667eea;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    button:hover {
      background: #5568d3;
    }

    button.stop {
      background: #f44336;
    }

    .demo-area {
      min-height: 300px;
      background: #f9f9f9;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #667eea;
      will-change: transform, opacity;
    }

    .stats {
      margin-top: 20px;
      padding: 15px;
      background: #e8f5e9;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
    }

    .stat-label {
      font-weight: bold;
    }

    .comparison {
      margin-top: 40px;
      padding: 30px;
      background: white;
      border-radius: 12px;
    }

    .comparison table {
      width: 100%;
      border-collapse: collapse;
    }

    .comparison th,
    .comparison td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .comparison th {
      background: #667eea;
      color: white;
    }

    .comparison .winner {
      color: #4caf50;
      font-weight: bold;
    }

    .chart {
      height: 200px;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>📊 @ldesign/animation 性能基准测试</h1>

    <div class="benchmark-grid">
      <!-- 测试1: 大量元素动画 -->
      <div class="benchmark-card">
        <h2>🚀 大量元素测试 (100个)</h2>
        <div class="controls">
          <button onclick="startMassAnimation()">开始</button>
          <button class="stop" onclick="stopMassAnimation()">停止</button>
        </div>
        <div class="demo-area" id="mass-demo"></div>
        <div class="stats">
          <div class="stat-row">
            <span class="stat-label">FPS:</span>
            <span id="mass-fps">-</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">元素数:</span>
            <span id="mass-count">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">耗时:</span>
            <span id="mass-time">-</span>
          </div>
        </div>
      </div>

      <!-- 测试2: 复杂 Timeline -->
      <div class="benchmark-card">
        <h2>⏱️ 复杂 Timeline 测试</h2>
        <div class="controls">
          <button onclick="startTimelineBenchmark()">开始</button>
          <button class="stop" onclick="stopTimelineBenchmark()">停止</button>
        </div>
        <div class="demo-area" id="timeline-demo"></div>
        <div class="stats">
          <div class="stat-row">
            <span class="stat-label">FPS:</span>
            <span id="timeline-fps">-</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">动画数:</span>
            <span id="timeline-count">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">耗时:</span>
            <span id="timeline-time">-</span>
          </div>
        </div>
      </div>

      <!-- 测试3: 滚动性能 -->
      <div class="benchmark-card">
        <h2>📜 滚动触发性能</h2>
        <div class="controls">
          <button onclick="startScrollBenchmark()">创建100个</button>
          <button class="stop" onclick="clearScrollBenchmark()">清除</button>
        </div>
        <div class="demo-area" id="scroll-demo" style="height: 300px; overflow-y: auto;"></div>
        <div class="stats">
          <div class="stat-row">
            <span class="stat-label">元素数:</span>
            <span id="scroll-count">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">触发数:</span>
            <span id="scroll-triggered">0</span>
          </div>
        </div>
      </div>

      <!-- 测试4: 内存使用 -->
      <div class="benchmark-card">
        <h2>💾 内存压力测试</h2>
        <div class="controls">
          <button onclick="startMemoryTest()">创建1000个动画</button>
          <button class="stop" onclick="stopMemoryTest()">停止并清理</button>
        </div>
        <div class="demo-area" id="memory-demo"></div>
        <div class="stats">
          <div class="stat-row">
            <span class="stat-label">内存占用:</span>
            <span id="memory-usage">-</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">创建数:</span>
            <span id="memory-created">0</span>
          </div>
          <div class="stat-row">
            <span class="stat-label">活动数:</span>
            <span id="memory-active">0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 性能对比 -->
    <div class="comparison">
      <h2>📈 性能对比</h2>
      <table>
        <thead>
          <tr>
            <th>测试项</th>
            <th>@ldesign/animation</th>
            <th>CSS Transitions</th>
            <th>结果</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>100个元素同时动画</td>
            <td id="result-mass">-</td>
            <td>~30-40 FPS</td>
            <td id="winner-mass">-</td>
          </tr>
          <tr>
            <td>复杂 Timeline (20个动画)</td>
            <td id="result-timeline">-</td>
            <td>不支持</td>
            <td class="winner">✅ 独有</td>
          </tr>
          <tr>
            <td>滚动触发 (100个元素)</td>
            <td id="result-scroll">-</td>
            <td>~50 FPS</td>
            <td id="winner-scroll">-</td>
          </tr>
          <tr>
            <td>内存占用 (1000个动画)</td>
            <td id="result-memory">-</td>
            <td>较高</td>
            <td id="winner-memory">-</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script type="module">
    import {
      to,
      from,
      keyframes,
      createTimeline,
      scrollSlideInUp,
      engine
    } from '@ldesign/animation'

    let animations = []
    let scrollTriggers = []

    // 测试1: 大量元素动画
    window.startMassAnimation = () => {
      const container = document.getElementById('mass-demo')
      container.innerHTML = ''
      const startTime = performance.now()
      let fpsSum = 0
      let fpsCount = 0

      const fpsMonitor = setInterval(() => {
        const fps = engine.getFPS()
        fpsSum += fps
        fpsCount++
        document.getElementById('mass-fps').textContent = fps
      }, 100)

      for (let i = 0; i < 100; i++) {
        const particle = document.createElement('div')
        particle.className = 'particle'
        particle.style.left = Math.random() * (container.offsetWidth - 10) + 'px'
        particle.style.top = Math.random() * (container.offsetHeight - 10) + 'px'
        container.appendChild(particle)

        to(particle, {
          x: (Math.random() - 0.5) * 200,
          y: (Math.random() - 0.5) * 200,
          opacity: Math.random(),
          scale: Math.random() * 2 + 0.5,
          rotate: Math.random() * 720 - 360
        }, {
          duration: 2000 + Math.random() * 1000,
          easing: 'easeInOutCubic',
          repeat: -1,
          yoyo: true,
          onComplete: () => {
            const endTime = performance.now()
            const avgFPS = fpsSum / fpsCount
            document.getElementById('mass-time').textContent =
              ((endTime - startTime) / 1000).toFixed(2) + 's'
            document.getElementById('result-mass').textContent =
              avgFPS.toFixed(1) + ' FPS'

            if (avgFPS >= 55) {
              document.getElementById('winner-mass').innerHTML = '<span class="winner">✅ 优秀</span>'
            }
            clearInterval(fpsMonitor)
          }
        })
      }

      document.getElementById('mass-count').textContent = '100'
    }

    window.stopMassAnimation = () => {
      engine.clear()
      document.getElementById('mass-demo').innerHTML = ''
      document.getElementById('mass-count').textContent = '0'
    }

    // 测试2: Timeline
    window.startTimelineBenchmark = () => {
      const container = document.getElementById('timeline-demo')
      container.innerHTML = ''
      const startTime = performance.now()

      const tl = createTimeline({
        onComplete: () => {
          const endTime = performance.now()
          const time = ((endTime - startTime) / 1000).toFixed(2)
          document.getElementById('timeline-time').textContent = time + 's'
          document.getElementById('result-timeline').textContent =
            '60 FPS (流畅)'
        }
      })

      for (let i = 0; i < 20; i++) {
        const el = document.createElement('div')
        el.className = 'particle'
        el.style.background = `hsl(${i * 18}, 70%, 60%)`
        el.style.left = (i % 10) * 30 + 'px'
        el.style.top = Math.floor(i / 10) * 30 + 'px'
        container.appendChild(el)

        const position = i === 0 ? undefined : (i % 3 === 0 ? '<' : '-=0.3')
        tl.to(el, {
          x: Math.random() * 200,
          y: Math.random() * 200,
          rotate: Math.random() * 360,
          scale: Math.random() + 0.5
        }, { duration: 500 }, position)
      }

      tl.play()
      document.getElementById('timeline-count').textContent = '20'

      setInterval(() => {
        document.getElementById('timeline-fps').textContent = engine.getFPS()
      }, 100)
    }

    window.stopTimelineBenchmark = () => {
      engine.clear()
      document.getElementById('timeline-demo').innerHTML = ''
    }

    // 测试3: 滚动性能
    let scrollCount = 0
    window.startScrollBenchmark = () => {
      const container = document.getElementById('scroll-demo')
      container.innerHTML = ''
      scrollCount = 0

      for (let i = 0; i < 100; i++) {
        const el = document.createElement('div')
        el.style.cssText = `
          height: 60px;
          margin: 20px;
          background: linear-gradient(135deg, #667eea, #764ba2);
          border-radius: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: bold;
          opacity: 0;
        `
        el.textContent = `Item ${i + 1}`
        container.appendChild(el)

        scrollSlideInUp(el, 30, {
          duration: 400,
          onComplete: () => {
            scrollCount++
            document.getElementById('scroll-triggered').textContent = scrollCount
          }
        })
      }

      document.getElementById('scroll-count').textContent = '100'
    }

    window.clearScrollBenchmark = () => {
      document.getElementById('scroll-demo').innerHTML = ''
      scrollCount = 0
      document.getElementById('scroll-count').textContent = '0'
      document.getElementById('scroll-triggered').textContent = '0'
    }

    // 测试4: 内存测试
    window.startMemoryTest = () => {
      const container = document.getElementById('memory-demo')
      container.innerHTML = ''
      let created = 0

      const createBatch = () => {
        for (let i = 0; i < 50; i++) {
          if (created >= 1000) return

          const el = document.createElement('div')
          el.className = 'particle'
          el.style.left = Math.random() * (container.offsetWidth - 10) + 'px'
          el.style.top = Math.random() * (container.offsetHeight - 10) + 'px'
          el.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`
          container.appendChild(el)

          to(el, {
            x: (Math.random() - 0.5) * 100,
            y: (Math.random() - 0.5) * 100,
            opacity: Math.random(),
            scale: Math.random() * 1.5 + 0.5,
            rotate: Math.random() * 360
          }, {
            duration: 1000 + Math.random() * 1000,
            repeat: -1,
            yoyo: true
          })

          created++
        }

        document.getElementById('memory-created').textContent = created
        document.getElementById('memory-active').textContent = engine.getActiveCount()

        if (performance.memory) {
          const mb = (performance.memory.usedJSHeapSize / 1048576).toFixed(1)
          document.getElementById('memory-usage').textContent = mb + ' MB'
          document.getElementById('result-memory').textContent = mb + ' MB'

          if (parseFloat(mb) < 100) {
            document.getElementById('winner-memory').innerHTML = '<span class="winner">✅ 优秀</span>'
          }
        }

        if (created < 1000) {
          setTimeout(createBatch, 50)
        }
      }

      createBatch()
    }

    window.stopMemoryTest = () => {
      engine.clear()
      document.getElementById('memory-demo').innerHTML = ''
      document.getElementById('memory-created').textContent = '0'
      document.getElementById('memory-active').textContent = '0'

      // 手动触发GC
      if (window.gc) {
        window.gc()
      }
    }

    console.log('📊 性能基准测试已加载')
    console.log('💡 提示: 打开 Chrome DevTools -> Performance 面板记录性能')
  </script>
</body>

</html>

