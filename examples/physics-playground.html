<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>物理动画游乐场</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0f0f23;
      color: white;
      overflow-x: hidden;
    }

    .header {
      text-align: center;
      padding: 40px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    h1 {
      font-size: 3em;
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .playground {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .demo-section {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
    }

    .demo-section h2 {
      font-size: 2em;
      margin-bottom: 20px;
      color: #667eea;
    }

    .demo-description {
      margin-bottom: 20px;
      opacity: 0.8;
      line-height: 1.6;
    }

    .demo-area {
      position: relative;
      height: 400px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .ball {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
      cursor: grab;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      user-select: none;
    }

    .ball:active {
      cursor: grabbing;
    }

    .spring-box {
      position: absolute;
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .control-group {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 8px;
    }

    .control-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #667eea;
    }

    input[type="range"] {
      width: 100%;
      margin-bottom: 5px;
    }

    .value-display {
      text-align: right;
      opacity: 0.7;
      font-size: 0.9em;
    }

    button {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    .preset-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
    }

    .preset-buttons button {
      padding: 10px;
      font-size: 14px;
    }

    .info-panel {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .info-item {
      text-align: center;
    }

    .info-value {
      font-size: 2em;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }

    .info-label {
      opacity: 0.7;
      font-size: 0.9em;
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>🎾 物理动画游乐场</h1>
    <p class="subtitle">探索弹簧和惯性物理模拟</p>
  </div>

  <div class="playground">
    <!-- 弹簧动画 -->
    <div class="demo-section">
      <h2>1. 弹簧动画 (Spring)</h2>
      <p class="demo-description">
        点击 "启动" 让方块弹向目标位置。调整参数体验不同的弹簧特性。
      </p>

      <div class="demo-area" id="spring-area">
        <div class="spring-box" id="spring-box">Spring</div>
      </div>

      <div class="controls">
        <div class="control-group">
          <label>刚度 (Stiffness)</label>
          <input type="range" id="stiffness" min="10" max="300" value="100">
          <div class="value-display" id="stiffness-value">100</div>
        </div>

        <div class="control-group">
          <label>阻尼 (Damping)</label>
          <input type="range" id="damping" min="1" max="50" value="10">
          <div class="value-display" id="damping-value">10</div>
        </div>

        <div class="control-group">
          <label>质量 (Mass)</label>
          <input type="range" id="mass" min="0.1" max="10" step="0.1" value="1">
          <div class="value-display" id="mass-value">1</div>
        </div>
      </div>

      <div class="preset-buttons">
        <button onclick="springDemo.setPreset('gentle')">柔和</button>
        <button onclick="springDemo.setPreset('wobbly')">活泼</button>
        <button onclick="springDemo.setPreset('stiff')">僵硬</button>
        <button onclick="springDemo.setPreset('bouncy')">弹性</button>
      </div>

      <button onclick="springDemo.start()" style="margin-top: 15px;">启动弹簧</button>
    </div>

    <!-- 惯性动画 -->
    <div class="demo-section">
      <h2>2. 惯性动画 (Inertia)</h2>
      <p class="demo-description">
        拖动小球释放，观察惯性减速效果。小球会在边界反弹。
      </p>

      <div class="demo-area" id="inertia-area">
        <div class="ball" id="inertia-ball">Ball</div>
      </div>

      <div class="controls">
        <div class="control-group">
          <label>摩擦力 (Friction)</label>
          <input type="range" id="friction" min="0.8" max="0.99" step="0.01" value="0.95">
          <div class="value-display" id="friction-value">0.95</div>
        </div>

        <div class="control-group">
          <label>反弹摩擦 (Bounce Friction)</label>
          <input type="range" id="bounce-friction" min="0.5" max="1" step="0.05" value="0.8">
          <div class="value-display" id="bounce-friction-value">0.8</div>
        </div>
      </div>

      <div class="info-panel">
        <div class="info-item">
          <div class="info-value" id="velocity-x">0</div>
          <div class="info-label">X 速度</div>
        </div>
        <div class="info-item">
          <div class="info-value" id="velocity-y">0</div>
          <div class="info-label">Y 速度</div>
        </div>
        <div class="info-item">
          <div class="info-value" id="position-x">0</div>
          <div class="info-label">X 位置</div>
        </div>
        <div class="info-item">
          <div class="info-value" id="position-y">0</div>
          <div class="info-label">Y 位置</div>
        </div>
      </div>
    </div>

    <!-- 综合演示 -->
    <div class="demo-section">
      <h2>3. 综合演示</h2>
      <p class="demo-description">
        多个小球同时进行物理模拟，展示性能和效果。
      </p>

      <div class="demo-area" id="multi-area"></div>

      <button onclick="multiDemo.start()">启动多球演示</button>
      <button onclick="multiDemo.stop()" style="margin-top: 10px;">停止</button>
    </div>
  </div>

  <script type="module">
    import {
      spring,
      springPresets,
      inertia,
      draggable,
      SpringAnimation
    } from '../es/index.js'

    // 弹簧演示
    const springBox = document.getElementById('spring-box')
    let springAnimation = null

    // 更新滑块值显示
    document.getElementById('stiffness').oninput = (e) => {
      document.getElementById('stiffness-value').textContent = e.target.value
    }
    document.getElementById('damping').oninput = (e) => {
      document.getElementById('damping-value').textContent = e.target.value
    }
    document.getElementById('mass').oninput = (e) => {
      document.getElementById('mass-value').textContent = e.target.value
    }
    document.getElementById('friction').oninput = (e) => {
      document.getElementById('friction-value').textContent = e.target.value
    }
    document.getElementById('bounce-friction').oninput = (e) => {
      document.getElementById('bounce-friction-value').textContent = e.target.value
    }

    window.springDemo = {
      start: () => {
        const config = {
          stiffness: parseFloat(document.getElementById('stiffness').value),
          damping: parseFloat(document.getElementById('damping').value),
          mass: parseFloat(document.getElementById('mass').value)
        }

        const target = Math.random() > 0.5 ? 400 : 0
        spring(springBox, 'x', target, config)
      },

      setPreset: (name) => {
        const preset = springPresets[name]
        document.getElementById('stiffness').value = preset.stiffness
        document.getElementById('damping').value = preset.damping
        document.getElementById('mass').value = preset.mass || 1

        document.getElementById('stiffness-value').textContent = preset.stiffness
        document.getElementById('damping-value').textContent = preset.damping
        document.getElementById('mass-value').textContent = preset.mass || 1
      }
    }

    // 惯性演示
    const inertiaBall = document.getElementById('inertia-ball')
    const inertiaArea = document.getElementById('inertia-area')

    let lastVelocity = { x: 0, y: 0 }

    draggable(inertiaBall, {
      bounds: inertiaArea,

      onRelease: (e) => {
        const friction = parseFloat(document.getElementById('friction').value)
        const bounceFriction = parseFloat(document.getElementById('bounce-friction').value)

        const rect = inertiaArea.getBoundingClientRect()

        inertia(inertiaBall, 'x', {
          velocity: e.velocity.x,
          friction,
          min: 0,
          max: rect.width - 60,
          bounce: true,
          bounceFriction,
          onUpdate: (value, velocity) => {
            lastVelocity.x = velocity
            updateInfo()
          }
        })

        inertia(inertiaBall, 'y', {
          velocity: e.velocity.y,
          friction,
          min: 0,
          max: rect.height - 60,
          bounce: true,
          bounceFriction,
          onUpdate: (value, velocity) => {
            lastVelocity.y = velocity
            updateInfo()
          }
        })
      }
    })

    function updateInfo() {
      const transform = inertiaBall.style.transform
      const match = transform.match(/translate\(([^,]+),\s*([^)]+)\)/)

      if (match) {
        const x = parseFloat(match[1])
        const y = parseFloat(match[2])

        document.getElementById('velocity-x').textContent = Math.round(lastVelocity.x)
        document.getElementById('velocity-y').textContent = Math.round(lastVelocity.y)
        document.getElementById('position-x').textContent = Math.round(x)
        document.getElementById('position-y').textContent = Math.round(y)
      }
    }

    // 多球演示
    const multiArea = document.getElementById('multi-area')
    let multiBalls = []
    let multiInterval = null

    window.multiDemo = {
      start: () => {
        multiArea.innerHTML = ''
        multiBalls = []

        const colors = [
          'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
          'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
          'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
          'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
          'linear-gradient(135deg, #30cfd0 0%, #330867 100%)'
        ]

        for (let i = 0; i < 10; i++) {
          const ball = document.createElement('div')
          ball.className = 'ball'
          ball.textContent = i + 1
          ball.style.background = colors[i % colors.length]
          ball.style.left = Math.random() * (multiArea.offsetWidth - 60) + 'px'
          ball.style.top = Math.random() * (multiArea.offsetHeight - 60) + 'px'

          multiArea.appendChild(ball)

          draggable(ball, {
            bounds: multiArea,
            onRelease: (e) => {
              inertia(ball, 'x', {
                velocity: e.velocity.x,
                friction: 0.95,
                min: 0,
                max: multiArea.offsetWidth - 60,
                bounce: true
              })

              inertia(ball, 'y', {
                velocity: e.velocity.y,
                friction: 0.95,
                min: 0,
                max: multiArea.offsetHeight - 60,
                bounce: true
              })
            }
          })

          multiBalls.push(ball)
        }

        // 随机弹射
        multiInterval = setInterval(() => {
          const ball = multiBalls[Math.floor(Math.random() * multiBalls.length)]
          const rect = multiArea.getBoundingClientRect()

          spring(ball, 'x', Math.random() * (rect.width - 60), springPresets.bouncy)
          spring(ball, 'y', Math.random() * (rect.height - 60), springPresets.bouncy)
        }, 2000)
      },

      stop: () => {
        if (multiInterval) {
          clearInterval(multiInterval)
          multiInterval = null
        }
      }
    }
  </script>
</body>

</html>